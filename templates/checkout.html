<!DOCTYPE html>
{%load static%}
<html lang="en">
<head>
    <link rel="stylesheet" href="{% static 'css/checkout.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>

    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div class="iphone">
  <header class="header">
    <h1>Checkout</h1>
  </header>

   <form action="/save/" id="pay" method="POST" enctype="multipart/form-data">{%csrf_token%}
    <div>
      <div class="name">
		  <label for="firstname">Firstname</label><br>
		  <div class="card">
          <input type="text" id="firstname" name="firstname"></div> &nbsp&nbsp
	      <label for="lastname">Lastname</label>
		  <div class="card">
          <input type="text" id="lastname" name="lastname"></div>
	  </div><br>
      <label for="address">Address</label>
      <div class="card">
        <input type="text" id="address" name="address">
      </div><br>
      <label for="place">Place</label>
      <div class="card">
      <input type="text" id="place" name="place"></div><br>
      <label for="landmark">Landmark</label><br>
      <div class="card">
      <input type="text" id="landmark" name="landmark"></div><br>
      <label for="phone">Phone Number</label>
      <div class="card">
        <input type="number" id="phone" name="phone">
      </div><br>
      <fieldset>
        <legend>Payment Method</legend>
        <div class="form__radio">
          <label for="cashondelivery"><svg class="icon">
              <use xlink:href="#icon-paypal" />
            </svg>Cash On Delivery</label>
          <input id="cashondelivery" name="payment-method" type="radio" value="cod" />
        </div><br>

        <div class="form__radio">
          <label for="onlinepayment"><svg class="icon">
              <use xlink:href="#icon-mastercard" />
            </svg>Online Payment</label>
          <input id="onlinepayment" name="payment-method" type="radio" value="online"/>
        </div>
      </fieldset><br>

    <div>
      <h2>Shopping Bill</h2><br>
      <h6>Your Order ID: {{ order_id }}</h6>

      <table>

        <tfoot>
          <tr>
            <td><label for="shippingcharge">shippingcharge</label></td>
            <td align="right"><input type="number" id="shippingcharge" name="shippingcharge" value="6" readonly></td>
          </tr>
          <tr>
            <td>Total</td>
            <td align="right">{{checkout_total1}}</td>
          </tr>
        </tfoot>
      </table>
    </div>
     <input type="hidden" name="order_id" value="{{razorpay_order_id}}">
     <input type="hidden" name="payment_id" value="{{payment_id}}">

      <div>
        <button id="rzp-button1" class="button button--full" type="submit"><svg class="icon">
            <use xlink:href="#icon-shopping-bag" />
          </svg>Buy Now</button>
      </div>
    </div>
   </form>
</div>


<!-- Razorpay's Javascript code. -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
    document.getElementById('pay').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent default form submission

        var cod = document.getElementById('cashondelivery').checked;
        var online = document.getElementById('onlinepayment').checked;

        if (cod) {
            // Submit the form directly for Cash on Delivery
            this.submit();
        } else if (online) {
            // Razorpay Payment Integration
            var options = {
                "key": "{{ razorpay_merchant_key }}", // Razorpay Key ID
                "amount": "{{ razorpay_amount }}",    // Amount in paise
                "currency": "{{ currency }}",
                "name": "test",
                "description": "Test Transaction",
                "image": "https://example.com/your_logo",
                "order_id": "{{ razorpay_order_id }}", // Razorpay Order ID
                "handler": function (response) {
                    // After successful payment, submit the form with payment ID
                    document.querySelector('#pay input[name=payment_id]').value = response.razorpay_payment_id;
                    document.getElementById('pay').submit();
                },
                "prefill": {
                    "name": "Your Name",
                    "email": "youremail@gmail.com",
                    "contact": "1234567890"
                },
                "notes": {
                    "address": "Razorpay Corporate Office"
                },
                "theme": {
                    "color": "rgb(104,222,238)"
                }
            };

            var rzp1 = new Razorpay(options);
            rzp1.on('payment.failed', function (response) {
                // Show modal or alert if payment fails
                $('#myModal').modal();
            });

            rzp1.open();
        } else {
            alert('Please select a payment method before proceeding.');
        }
    });
</script>

</body>
</html>